<!DOCTYPE html>
<html>
<head>
  <title>خريطة جزيرة العرب مع نقاط مخصصة</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- تضمين Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <!-- تضمين Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-pg+Y7N0I4/0XxYpR1I3k1/uJbtCjYzHdIw5rXB8fYq/8M7jJ6HX/XY6Y7SLiyYHjdQ8sxclHQS55jFN/R6k1xg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    .custom-marker {
      text-align: center;
    }
    .custom-marker i {
      font-size: 2em; /* استخدام وحدات نسبية لتناسب جميع الشاشات */
      color: #f00; /* يمكنك تغيير اللون حسب الرغبة */
    }
    .custom-marker span {
      display: block;
      margin-top: 4px;
      font-size: 1em; /* استخدام وحدات نسبية */
      color: #fff; /* لون الخط أبيض */
      font-weight: bold;
      text-shadow:
        -1px -1px 0 #000,
        1px -1px 0 #000,
        -1px 1px 0 #000,
        1px 1px 0 #000; /* حدود سوداء حول النص */
    }
  </style>
</head>
<body>
  <!-- عنصر الخريطة -->
  <div id="map"></div>

  <!-- تضمين Leaflet JavaScript -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- تضمين Papa Parse لتحليل CSV -->
  <script src="https://unpkg.com/papaparse@5.3.2/papaparse.min.js"></script>
  <script>
    // تحديد حدود جزيرة العرب مع تمديدها قليلاً نحو الغرب والشمال
    var arabianBounds = L.latLngBounds(
      [10.0, 30.0], // الزاوية الجنوبية الغربية (خط العرض، خط الطول)
      [35.0, 65.0]  // الزاوية الشمالية الشرقية
    );

    // تهيئة الخريطة وتحديد الموقع والزووم الافتراضي
    var map = L.map('map', {
      center: arabianBounds.getCenter(),
      zoom: 5,
      minZoom: 4, // الحد الأدنى للتكبير
      maxZoom: 10, // الحد الأقصى للتكبير
      maxBounds: arabianBounds,
      maxBoundsViscosity: 1.0,
      zoomControl: true,
      attributionControl: false
    });

    // إضافة طبقة Esri World Imagery إلى الخريطة مع تحديد الحدود
    var Esri_WorldImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      attribution: '',
      bounds: arabianBounds,
      noWrap: true,
      minZoom: 4,
      maxZoom: 10
    }).addTo(map);

    // منع تحميل البلاطات خارج الحدود المحددة
    Esri_WorldImagery.on('tileloadstart', function(event) {
      var tile = event.tile;
      var tileSize = this.getTileSize();
      var tilePoint = this._tileCoordsToNwSe(event.coords);
      var tileBounds = L.latLngBounds(tilePoint[0], tilePoint[1]);

      if (!arabianBounds.intersects(tileBounds)) {
        tile.src = L.Util.emptyImageUrl;
      }
    });

    // ضبط حدود الخريطة لتكون الحدود الجديدة الممتدة
    map.setMaxBounds(arabianBounds);

    // خيار إضافي: تغيير موضع عناصر التحكم في التكبير/التصغير
    map.zoomControl.setPosition('topright');

    // وظيفة لتحميل بيانات CSV وإضافة النقاط إلى الخريطة
    function loadCSVData() {
      var csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSNx5cQzCbAG4rUIQFsvnlVozC4jsofepc4hG1BQxyoUYaYZtQtXip8nMEoDP95cTMAJ5xtOwi-4qgU/pub?output=csv';

      Papa.parse(csvUrl, {
        download: true,
        header: true,
        complete: function(results) {
          var data = results.data;
          data.forEach(function(item) {
            var lat = parseFloat(item.Latitude);
            var lng = parseFloat(item.Longitude);
            var name = item.Name;

            if (!isNaN(lat) && !isNaN(lng)) {
              // إنشاء محتوى HTML للأيقونة المخصصة باستخدام Font Awesome
              var iconHtml = '<div class="custom-marker">' +
                              '<i class="fas fa-crossed-swords"></i>' +
                              '<span>' + name + '</span>' +
                             '</div>';

              // إنشاء DivIcon مع المحتوى المخصص
              var customIcon = L.divIcon({
                html: iconHtml,
                className: '',
                iconSize: null, // السماح للأيقونة بتحديد حجمها تلقائياً
                iconAnchor: [16, 48] // ضبط نقطة التثبيت
              });

              // إضافة العلامة إلى الخريطة
              var marker = L.marker([lat, lng], { icon: customIcon }).addTo(map);
            }
          });
        },
        error: function(err) {
          console.error('حدث خطأ أثناء تحميل بيانات CSV:', err);
        }
      });
    }

    // استدعاء الوظيفة لتحميل البيانات
    loadCSVData();

  </script>
</body>
</html>
