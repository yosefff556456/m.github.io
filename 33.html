<!DOCTYPE html>
<html>
<head>
  <title>خريطة جزيرة العرب مع نقاط مخصصة</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- تضمين Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    .custom-marker {
      text-align: center;
    }
    .custom-marker img {
      display: block;
      margin: 0 auto;
    }
    .custom-marker span {
      display: block;
      margin-top: 4px;
      font-size: 14px;
      color: #000;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- عنصر الخريطة -->
  <div id="map"></div>

  <!-- تضمين Leaflet JavaScript -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- تضمين Papa Parse لتحليل CSV -->
  <script src="https://unpkg.com/papaparse@5.3.2/papaparse.min.js"></script>
  <script>
    // تحديد حدود جزيرة العرب مع تمديدها قليلاً نحو الغرب والشمال
    var arabianBounds = L.latLngBounds(
      [10.0, 30.0], // الزاوية الجنوبية الغربية (خط العرض، خط الطول)
      [35.0, 65.0]  // الزاوية الشمالية الشرقية
    );

    // تهيئة الخريطة وتحديد الموقع والزووم الافتراضي
    var map = L.map('map', {
      center: arabianBounds.getCenter(),
      zoom: 5,
      minZoom: 4, // الحد الأدنى للتكبير
      maxZoom: 10, // الحد الأقصى للتكبير
      maxBounds: arabianBounds,
      maxBoundsViscosity: 1.0,
      zoomControl: true,
      attributionControl: false
    });

    // إضافة طبقة Esri World Imagery إلى الخريطة مع تحديد الحدود
    var Esri_WorldImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      attribution: '',
      bounds: arabianBounds,
      noWrap: true,
      minZoom: 4,
      maxZoom: 10
    }).addTo(map);

    // منع تحميل البلاطات خارج الحدود المحددة
    Esri_WorldImagery.on('tileloadstart', function(event) {
      var tile = event.tile;
      var tileSize = this.getTileSize();
      var tilePoint = this._tileCoordsToNwSe(event.coords);
      var tileBounds = L.latLngBounds(tilePoint[0], tilePoint[1]);

      if (!arabianBounds.intersects(tileBounds)) {
        tile.src = L.Util.emptyImageUrl;
      }
    });

    // ضبط حدود الخريطة لتكون الحدود الجديدة الممتدة
    map.setMaxBounds(arabianBounds);

    // خيار إضافي: تغيير موضع عناصر التحكم في التكبير/التصغير
    map.zoomControl.setPosition('topright');

    // إنشاء أيقونة مخصصة
    var battleIcon = L.icon({
      iconUrl: 'swords.png', // تأكد من أن الصورة 'swords.png' موجودة في نفس مسار الملف
      iconSize: [32, 32], // حجم الأيقونة (يمكنك تعديله)
      iconAnchor: [16, 32], // نقطة تثبيت الأيقونة
      popupAnchor: [0, -32] // موقع النافذة المنبثقة بالنسبة للأيقونة
    });

    // وظيفة لتحميل بيانات CSV وإضافة النقاط إلى الخريطة
    function loadCSVData() {
      var csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSNx5cQzCbAG4rUIQFsvnlVozC4jsofepc4hG1BQxyoUYaYZtQtXip8nMEoDP95cTMAJ5xtOwi-4qgU/pub?output=csv';

      Papa.parse(csvUrl, {
        download: true,
        header: true,
        complete: function(results) {
          var data = results.data;
          data.forEach(function(item) {
            var lat = parseFloat(item.Latitude);
            var lng = parseFloat(item.Longitude);
            var name = item.Name;

            if (!isNaN(lat) && !isNaN(lng)) {
              // إنشاء محتوى HTML للأيقونة المخصصة
              var iconHtml = '<div class="custom-marker">' +
                              '<img src="swords.png" alt="سيفين" width="32" height="32">' +
                              '<span>' + name + '</span>' +
                             '</div>';

              // إنشاء DivIcon مع المحتوى المخصص
              var customIcon = L.divIcon({
                html: iconHtml,
                className: '',
                iconSize: [32, 48], // يمكن تعديل الحجم حسب الحاجة
                iconAnchor: [16, 48] // ضبط نقطة التثبيت
              });

              // إضافة العلامة إلى الخريطة
              var marker = L.marker([lat, lng], { icon: customIcon }).addTo(map);
            }
          });
        },
        error: function(err) {
          console.error('حدث خطأ أثناء تحميل بيانات CSV:', err);
        }
      });
    }

    // استدعاء الوظيفة لتحميل البيانات
    loadCSVData();

  </script>
</body>
</html>
